<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ğŸŒ€ Codex Quantum Periodic Interface</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #111; color: #eee; margin: 20px; }
    h1, h2 { color: #00bfff; }
    select, button { padding: 8px; margin: 10px; background-color: #222; color: #eee; border: 1px solid #555; }
    .panel { margin-bottom: 20px; padding: 10px; border: 1px solid #333; background-color: #1a1a1a; }
    .summary, .output { background-color: #222; padding: 10px; border: 1px solid #444; }
    .warning { color: #ff4444; font-weight: bold; }
  </style>
</head>
<body>
  <h1>ğŸŒ€ Codex Quantum Periodic Interface</h1>
  <img id="spiralRender" src="spiral_field.gif" alt="Quantum Spiral Field" style="width:100%;max-width:600px;display:block;margin:auto;" />

  <div class="panel">
    <h2>ğŸ§© Step 1: Select Element A</h2>
    <select id="elementA" onchange="updatePairings()"></select>
  </div>
  <div class="panel">
    <h2>ğŸ§© Step 2: Suggested Pairings (Element B)</h2>
    <select id="elementB" onchange="updateRefinements()"></select>
  </div>
  <div class="panel">
    <h2>ğŸ§© Step 3: Refinement Element (Element C)</h2>
    <select id="elementC" onchange="synthesizeMolecule()"></select>
  </div>
  <div class="panel">
    <h2>ğŸ§¬ Final Molecule Synthesis</h2>
    <div id="moleculeSummary" class="summary">Select all three elements to view synthesis.</div>
    <div id="codexWarning" class="warning"></div>
  </div>
  <div class="panel">
    <h2>ğŸ” Observable Use Case</h2>
    <div id="useCase" class="output">Awaiting synthesis...</div>
  </div>
  <div class="panel">
    <h2>ğŸ–¼ï¸ Field Visualization</h2>
    <button onclick="viewFieldRender()">ğŸ”¬ View Element Field Render</button>
    <button onclick="viewFinalField()">ğŸŒŒ View Final Material Field</button>
  </div>

  <script>
    let elements = [];

    function elemFreq(vol, den, en) {
      const phi = 1.618;
      return ((vol * den) / (en + 1e-6)) * phi;
    }

    function populateDropdowns() {
      const selectA = document.getElementById("elementA");
      selectA.innerHTML = elements.map(e => `<option>${e.Element}</option>`).join('');
      updatePairings();
    }

function updatePairings() {
  const selectB = document.getElementById("elementB");
  selectB.innerHTML = elements.map(e => `<option>${e.Element}</option>`).join('');
  updateRefinements();
}


    function updateRefinements() {
      const refinements = elements.filter(e => !e.FunctionPolarity || e.FunctionPolarity === "Useful");
      const selectC = document.getElementById("elementC");
      selectC.innerHTML = refinements.map(e => `<option>${e.Element}</option>`).join('');
      synthesizeMolecule();
    }

    function synthesizeMolecule() {
      const a = document.getElementById("elementA").value;
      const b = document.getElementById("elementB").value;
      const c = document.getElementById("elementC").value;
      const A = elements.find(e => e.Element === a);
      const B = elements.find(e => e.Element === b);
      const C = elements.find(e => e.Element === c);
      if (!A || !B || !C) return;

      const malefic = [A, B, C].filter(e => e.FunctionPolarity === "Malific");
      if (malefic.length > 0) {
        document.getElementById("codexWarning").innerText = "âš ï¸ You are violating a Prime Directive of the UNIVERSAL CODEX. Malefic combinations are not permitted.";
        document.getElementById("moleculeSummary").innerText = "â›” Synthesis blocked.";
        document.getElementById("useCase").innerText = "Codex integrity preserved.";
        return;
      } else {
        document.getElementById("codexWarning").innerText = "";
      }

      const energy = ((A.Energy + B.Energy + C.Energy) / 3).toFixed(2);
      const density = ((A.Density + B.Density + C.Density) / 3).toFixed(2);
      const volume = (A.Volume + B.Volume + C.Volume).toFixed(2);
      const freq = elemFreq(+volume, +density, +energy).toFixed(2);

      document.getElementById("moleculeSummary").innerHTML = `
        <p><strong>Energy:</strong> ${energy} eV</p>
        <p><strong>Density:</strong> ${density} g/cmÂ³</p>
        <p><strong>Volume:</strong> ${volume} cmÂ³/mol</p>
        <p><strong>Resonance Frequency:</strong> ${freq}</p>
        <p><strong>Polarity:</strong> Useful</p>
      `;

      document.getElementById("useCase").innerHTML = `
        <ul>
          <li>ğŸ§  Memory Stabilizer</li>
          <li>ğŸ« Breath Enhancer</li>
          <li>ğŸ›¡ï¸ Lattice Shield</li>
          <li>ğŸŒ€ Spiral Anchor</li>
          <li>â˜¯ Void Harmonizer</li>
        </ul>
      `;

      document.getElementById("spiralRender").src = "compound_field.gif";
    }

    function viewFieldRender() {
      window.open("element_field_app.html", "_blank");
    }

    function viewFinalField() {
      window.open("compound_field_app.html", "_blank");
    }

    window.onload = () => {
      fetch('elements.csv')
        .then(response => response.text())
        .then(data => {
          const lines = data.trim().split('\n');
          const headers = lines[0].split(',').map(h => h.trim());
          elements = lines.slice(1).map(line => {
            const parts = line.split(',');
            if (parts[0] === "Element") return null;
            const obj = {};
            headers.forEach((h, i) => {
              const val = parts[i] ? parts[i].trim() : "#";
              obj[h] = isNaN(val) || val === "" || val === "#" ? val : +val;
            });
            if (!("FunctionPolarity" in obj)) obj.FunctionPolarity = "#";
            return obj;
          }).filter(Boolean);
          populateDropdowns();
        })
        .catch(error => {
          console.error("Error loading elements.csv:", error);
          alert("Codex dataset failed to load.");
        });
    };
  </script>
</body>
</html>
